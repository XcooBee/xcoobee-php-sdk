var XcooBee=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=20)}([function(e,t,r){"use strict";var n=r(31).GraphQLClient,o=r(1),i=/^[\w\/=+]+$/,a=/^[-+\w]+(\.[-+\w]+)*@([-a-z0-9]+\.)+[a-z]{2,6}$/i,s=function(e){return"at line: "+e.line+", column: "+e.column},u=function(e){var t=[];return e.message&&t.push(e.message),e.locations&&t.push(e.locations.map(s).join(", ")),0===t.length&&t.push(JSON.stringify(e)),t=t.join(" ")};e.exports={appearsToBeACursor:function(e){return i.test(e)},appearsToBeAnEmailAddress:function(e){return a.test(e)},assertAppearsToBeACampaignId:function(e){if(!function(e){return"string"==typeof e&&e.length>0}(e))throw new o("Campaign ID is required")},createClient:function(e,t){return new n(e+"/graphql",{headers:{Authorization:""+t}})},transformError:function(e){if(e instanceof o)return e;var t=0;if(e.response&&"number"==typeof e.response.status&&(t=e.response.status),401===t)return new o("401 Unauthorized.  Please make sure your API access token is fresh.");if(e.response&&e.response.errors){var r=e.response.errors;Array.isArray(r)||(r=[r]);var n=r.map(u).join("\n");return new o(n)}return new o(e)}}},function(e,t,r){"use strict";function n(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var o=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n)));return Error.captureStackTrace(i,t),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n(Error)),t}();o.prototype.name="XcooBeeError",e.exports=o},function(e,t,r){"use strict";var n=r(7),o=function(e){function t(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{code:e,error:r}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();e.exports=o},function(e,t,r){"use strict";var n,o,i,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],o=function(t){t=t;var r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=o(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},c=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},f=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,s=o/(4*i),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*i,c=e.min(4*u,o);if(u){for(var f=0;f<u;f+=i)this._doProcessBlock(n,f);var p=n.splice(0,u);r.sigBytes-=c}return new a.init(p,c)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),l=(o.Hasher=p.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new l.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math);return e},"object"===s(t)?e.exports=t=a():(o=[],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i))},function(e,t,r){"use strict";var n,o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=(n=regeneratorRuntime.mark(function e(t,r,n){var o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r,i({},n,{after:null}));case 3:return o=e.sent,a=new u(t,o,r,n),e.abrupt("return",a);case 8:throw e.prev=8,e.t0=e.catch(0),new s(400,e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e,t,r){return o.apply(this,arguments)});var s=r(2),u=r(41);e.exports={resolveApiCfg:function(e,t){return e&&"apiKey"in e&&"apiSecret"in e&&"apiUrlRoot"in e?{apiKey:e.apiKey,apiSecret:e.apiSecret,apiUrlRoot:e.apiUrlRoot}:t&&"apiKey"in t&&"apiSecret"in t&&"apiUrlRoot"in t?{apiKey:t.apiKey,apiSecret:t.apiSecret,apiUrlRoot:t.apiUrlRoot}:null},resolveCampaignId:function(e,t,r){return e&&"string"==typeof e?e:t&&"string"==typeof t.campaignId?t.campaignId:r&&"string"==typeof r.campaignId?r.campaignId:null},resolveSdkCfg:function(e,t){return e&&"apiKey"in e&&"apiSecret"in e&&"apiUrlRoot"in e?{apiKey:e.apiKey,apiSecret:e.apiSecret,apiUrlRoot:e.apiUrlRoot,pgpPassword:e.pgpPassword,pgpSecret:e.pgpSecret}:t&&"apiKey"in t&&"apiSecret"in t&&"apiUrlRoot"in t?{apiKey:t.apiKey,apiSecret:t.apiSecret,apiUrlRoot:t.apiUrlRoot,pgpPassword:t.pgpPassword,pgpSecret:t.pgpSecret}:null},startPaging:a}},function(e,t,r){"use strict";var n=r(7),o=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{code:200,error:null,result:e}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();e.exports=o},function(e,t,r){"use strict";var n=Object.freeze(["bee_icon","invite_list","outbox","profile_image"]),o=Object.freeze({BEE_ICON:"bee_icon",INVITE_LIST:"invite_list",OUTBOX:"outbox",PROFILE_IMAGE:"profile_image",values:n});e.exports=o},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw TypeError("Response `info` is required.");if(t.code<200||t.code>599)throw TypeError("`code` must be a valid HTTP status code.");if(t.code<300){if(null===t.result||void 0===t.result)throw TypeError("`result` is required for successful responses.")}else{if(null===t.error||void 0===t.error)throw TypeError("`error` is required for non-successful responses.");if(null===t.error.message||void 0===t.error.message)throw TypeError("`error.message` is required for non-successful responses.")}this._=n({},t,{time:new Date})}return o(e,[{key:"getNextPage",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(){return t.apply(this,arguments)}}()},{key:"hasNextPage",value:function(){return!!this._.hasNextPage}},{key:"code",get:function(){return this._.code}},{key:"result",get:function(){return this._.result}},{key:"error",get:function(){return this._.error}},{key:"time",get:function(){return this._.time}}]),e}();e.exports=i},function(e,t,r){},function(e,t,r){"use strict";var n,o,i=r(47).fetchOpenpgp,a=(n=regeneratorRuntime.mark(function e(t,r,n){var o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return o=e.sent,e.next=5,o.key.readArmored(r);case 5:if(a=e.sent.keys[0],!n){e.next=9;break}return e.next=9,a.decrypt(n);case 9:return e.next=11,o.message.readArmored(t);case 11:return e.t0=e.sent,e.t1=[a],s={message:e.t0,privateKeys:e.t1},e.next=16,o.decrypt(s);case 16:return u=e.sent,e.abrupt("return",u.data);case 18:case"end":return e.stop()}},e,void 0)}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e,t,r){return o.apply(this,arguments)});e.exports={decryptWithEncryptedPrivateKey:a}},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";var n,o=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(r,n){var o=this,i=t.extractMessage(r)+": "+JSON.stringify({response:r,request:n});return(o=e.call(this,i)||this).response=r,o.request=n,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(o,t),o}return o(t,e),t.extractMessage=function(e){try{return e.errors[0].message}catch(t){return"GraphQL Error (Code: "+e.status+")"}},t}(Error);t.ClientError=i},function(e,t,r){"use strict";var n=r(0),o=function e(t,r){var o=r;if(o in e._.unfulfilledPromises)return e._.unfulfilledPromises[o];var i=n.createClient(t,r).request("\n    query {\n      user {\n        cursor\n        xcoobee_id\n        pgp_public_key\n      }\n    }\n  ").then(function(t){return delete e._.unfulfilledPromises[o],t.user}).catch(function(t){throw delete e._.unfulfilledPromises[o],n.transformError(t)});return e._.unfulfilledPromises[o]=i,i};o._={unfulfilledPromises:{}},e.exports={getUser:o,getUserPublicKey:function(e,t,r){return n.createClient(e,t).request("\n    query getUserPublicKey($xid: String!) {\n      users(xcoobee_id: $xid) {\n          data {\n              pgp_public_key\n          }\n      }\n    }\n  ",{xid:r}).then(function(e){var t=e.users.data[0];return t&&t.pgp_public_key||""}).catch(function(e){throw n.transformError(e)})}}},function(e,t,r){"use strict";var n=r(0);e.exports={addDirective:function(e,t,r){return n.createClient(e,t).request("\n    mutation addDirective($directiveInput: DirectiveInput!) {\n      add_directive(params: $directiveInput) {\n        ref_id\n      }\n    }\n  ",{directiveInput:r}).then(function(e){return e.add_directive.ref_id}).catch(function(e){throw n.transformError(e)})}}},function(e,t,r){"use strict";var n,o,i=(n=regeneratorRuntime.mark(function e(t,r,n,o,i){var p,l,h,d,y,g,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.findEndPoint(t,r,n,o,"flex");case 2:if(p=e.sent){e.next=5;break}throw new c('Unable to find an endpoint named "'+o+'" or "flex".');case 5:return l=o,h=p.cursor,e.next=9,u.upload_policy(t,r,l,h,i);case 9:return d=e.sent,y=f(i,d),e.next=13,Promise.all(y.map(function(e){var t=e.file,r=e.policy;return s.upload_file(t,r).catch(function(e){return e})}));case 13:return g=e.sent,_=y.map(function(e,t){var r=e.file,n=g[t];return n instanceof Error?{success:!1,error:n,file:r}:{success:!0,file:r}}),e.abrupt("return",_);case 16:case"end":return e.stop()}},e,this)}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e,t,r,n,i){return o.apply(this,arguments)});var a=r(36),s=r(38),u=r(40),c=r(1);function f(e,t){for(var r=[],n=Math.max(e.length,t.length),o=0;o<n;++o){var i=e[o]||null,a=t[o]||null;r.push({file:i,policy:a})}return r}e.exports={upload:i}},function(e,t,r){"use strict";var n=r(0);e.exports={getCampaignInfo:function(e,t,r){n.assertAppearsToBeACampaignId(r);return n.createClient(e,t).request("\n    query getCampaignInfo($campaignId: String!) {\n      campaign(campaign_cursor: $campaignId) {\n        campaign_description {\n          text\n        }\n        campaign_name\n        campaign_title {\n          text\n        }\n        date_c\n        date_e\n        email_targets {\n          email\n        }\n        endpoint\n        status\n        targets {\n          name\n          recipient\n        }\n        xcoobee_targets {\n          xcoobee_id\n        }\n      }\n    }\n  ",{campaignId:r}).then(function(e){return{campaign:e.campaign}}).catch(function(e){throw n.transformError(e)})},getCampaigns:function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return n.createClient(e,t).request("\n    query getCampaigns($userCursor: String!, $after: String, $first: Int) {\n      campaigns(user_cursor: $userCursor, after: $after, first: $first) {\n        data {\n          campaign_cursor\n          campaign_name\n          status\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:o,first:i,userCursor:r}).then(function(e){return e.campaigns}).catch(function(e){throw n.transformError(e)})}}},function(e,t,r){"use strict";var n,o,i=r(0),a=r(50),s=function(e,t,r,n){return i.createClient(e,t).request("\n    query getNoteTarget($referenceId: String!, $type: NoteType!){\n      note_target (reference_cursor: $referenceId, note_type: $type){\n          cursor\n      }\n    }\n  ",{referenceId:r,type:n}).then(function(e){return e.note_target.cursor}).catch(function(e){throw i.transformError(e)})},u=(n=regeneratorRuntime.mark(function e(t,r,n){var o,u,c,f,p,l,h,d,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o="\n    mutation sendUserMessage($config: SendMessageConfig) {\n      send_message(config: $config) {\n        date_c\n        date_e\n        note_text\n        target_cursor\n        xcoobee_id\n      }\n    }\n  ",u=y.consentId,c=y.ticketId,f=y.requestRef,p=void 0,l=void 0,!u){e.next=9;break}p=a.CONSENT,l=u,e.next=20;break;case 9:if(!c){e.next=14;break}p=a.TICKET,l=c,e.next=20;break;case 14:if(!f){e.next=19;break}p=a.DATA_REQUEST,l=f,e.next=20;break;case 19:throw new TypeError("At least one reference should be provided");case 20:return e.next=22,s(t,r,l,p);case 22:return h=e.sent,d={reference_cursor:l,message:n,note_type:p,user_cursor:h},e.abrupt("return",i.createClient(t,r).request(o,{config:d}).then(function(e){return e.send_message}).catch(function(e){throw i.transformError(e)}));case 25:case"end":return e.stop()}},e,void 0)}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e,t,r){return o.apply(this,arguments)});e.exports={getConversation:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return i.createClient(e,t).request("\n    query getConversation($targetCursor: String!, $after: String, $first: Int) {\n      conversation(target_cursor: $targetCursor, after: $after, first: $first) {\n        data {\n          reference_cursor\n          date_c\n          date_e\n          display_city\n          display_country\n          display_name\n          display_province\n          is_outbound\n          note_text\n          note_type\n          photo_url\n          xcoobee_id\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:n,first:o,targetCursor:r}).then(function(e){return e.conversation}).catch(function(e){throw i.transformError(e)})},getConversations:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return i.createClient(e,t).request("\n    query getConversations($userCursor: String!, $after: String, $first: Int) {\n      conversations(user_cursor: $userCursor, after: $after, first: $first) {\n        data {\n          date_c\n          display_name\n          note_type\n          target_cursor\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:n,first:o,userCursor:r}).then(function(e){return e.conversations}).catch(function(e){throw i.transformError(e)})},sendUserMessage:u}},function(e,t,r){"use strict";var n,o,i,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){var t,r,n,o,i,a,s;return r=(t=e).lib,n=r.WordArray,o=r.Hasher,i=t.algo,a=[],s=i.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],s=r[3],u=r[4],c=0;c<80;c++){if(c<16)a[c]=0|e[t+c];else{var f=a[c-3]^a[c-8]^a[c-14]^a[c-16];a[c]=f<<1|f>>>31}var p=(n<<5|n>>>27)+u+a[c];p+=c<20?1518500249+(o&i|~o&s):c<40?1859775393+(o^i^s):c<60?(o&i|o&s|i&s)-1894007588:(o^i^s)-899497514,u=s,s=i,i=o<<30|o>>>2,o=n,n=p}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=o._createHelper(s),t.HmacSHA1=o._createHmacHelper(s),e.SHA1},"object"===s(t)?e.exports=t=a(r(3)):(o=[r(3)],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i))},function(e,t,r){"use strict";var n,o,i,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){var t,r,n;r=(t=e).lib.Base,n=t.enc.Utf8,t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,o=4*r;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,u=a.words,c=0;c<r;c++)s[c]^=1549556828,u[c]^=909522486;i.sigBytes=a.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})},"object"===s(t)?e.exports=t=a(r(3)):(o=[r(3)],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i))},function(e,t,r){"use strict";var n=r(1),o=r(0),i={BreachBeeUsed:"breach_bee_used",BreachPresented:"breach_presented",ConsentApproved:"consent_approved",ConsentChanged:"consent_changed",ConsentDeclined:"consent_declined",ConsentExpired:"consent_expired",ConsentNearExpiration:"consent_near_expiration",DataApproved:"data_approved",DataChanged:"data_changed",DataDeclined:"data_declined",DataExpired:"data_expired",DataNearExpiration:"data_near_expiration",UserDataRequest:"user_data_request",UserMessage:"user_message"},a=function(e){if(!(e in i))throw new n('Invalid event type provided: "'+e+'".');return i[e]};e.exports={addEventSubscription:function(e,t,r,n){o.assertAppearsToBeACampaignId(n);var i=[];for(var s in r)i.push({handler:r[s],event_type:a(s)});var u={campaign_cursor:n,events:i};return o.createClient(e,t).request("\n    mutation addEventSubscription($config: AddSubscriptionsConfig!) {\n      add_event_subscriptions(config: $config) {\n        data {\n          campaign_cursor\n          date_c\n          event_type\n          handler\n          owner_cursor\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{config:u}).then(function(e){return e.add_event_subscriptions}).catch(function(e){throw o.transformError(e)})},deleteEventSubscription:function(e,t,r,n){o.assertAppearsToBeACampaignId(n);var i=[];r.forEach(function(e){i.push(a(e))});var s={campaign_cursor:n,events:i};return o.createClient(e,t).request("\n    mutation deleteEventSubscription($config: DeleteSubscriptionsConfig!) {\n      delete_event_subscriptions(config: $config) {\n        deleted_number\n      }\n    }\n  ",{config:s}).then(function(e){return e.delete_event_subscriptions}).catch(function(e){throw o.transformError(e)})},listEventSubscriptions:function(e,t,r){o.assertAppearsToBeACampaignId(r);return o.createClient(e,t).request("\n    query listEventSubscriptions($campaignId: String!) {\n      event_subscriptions(campaign_cursor: $campaignId) {\n        data {\n          campaign_cursor\n          date_c\n          event_type\n          handler\n          owner_cursor\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{campaignId:r}).then(function(e){var t=e.event_subscriptions;return t.page_info=t.page_info||{end_cursor:null,has_next_page:!1},t}).catch(function(e){throw o.transformError(e)})},toEventType:a}},function(e,t,r){r(21),e.exports=r(22)},function(e,t,r){"use strict";(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(r){var n,o=Object.prototype,i=o.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag",f="object"===t(e),p=r.regeneratorRuntime;if(p)f&&(e.exports=p);else{(p=r.regeneratorRuntime=f?e.exports:{}).wrap=w;var l="suspendedStart",h="suspendedYield",d="executing",y="completed",g={},_={};_[s]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(P([])));m&&m!==o&&i.call(m,s)&&(_=m);var b=S.prototype=E.prototype=Object.create(_);C.prototype=b.constructor=S,S.constructor=C,S[c]=C.displayName="GeneratorFunction",p.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},p.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},p.awrap=function(e){return{__await:e}},T(A.prototype),A.prototype[u]=function(){return this},p.AsyncIterator=A,p.async=function(e,t,r,n){var o=new A(w(e,t,r,n));return p.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},T(b),b[c]="Generator",b[s]=function(){return this},b.toString=function(){return"[object Generator]"},p.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},p.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),g}}}function w(e,t,r,n){var o=t&&t.prototype instanceof E?t:E,i=Object.create(o.prototype),a=new k(n||[]);return i._invoke=function(e,t,r){var n=l;return function(o,i){if(n===d)throw new Error("Generator is already running");if(n===y){if("throw"===o)throw i;return U()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=x(e,t,r);if("normal"===u.type){if(n=r.done?y:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=y,r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function x(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function E(){}function C(){}function S(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var r;this._invoke=function(n,o){function a(){return new Promise(function(r,a){!function r(n,o,a,s){var u=x(e[n],e,o);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"===(void 0===f?"undefined":t(f))&&i.call(f,"__await")?Promise.resolve(f.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):Promise.resolve(f).then(function(e){c.value=e,a(c)},s)}s(u.arg)}(n,o,r,a)})}return r=r?r.then(a,a):a()}}function R(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,R(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=x(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,g;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function P(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:U}}function U(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())}).call(this,r(10)(e))},function(e,t,r){"use strict";var n=r(23),o=r(24);e.exports={sdk:{Config:n,Sdk:o}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw TypeError("Config `data` is required.");var r=t.apiKey,n=t.apiSecret,o=t.apiUrlRoot||"https://api.xcoobee.net",i=t.campaignId,a=t.encrypt,s=t.pgpPassword,u=t.pgpSecret;if(i=void 0===i?null:i,a=void 0!==a&&a,s=void 0===s?null:s,u=void 0===u?null:u,!r||"string"!=typeof r)throw new TypeError("API key is required.");if(!n||"string"!=typeof n)throw new TypeError("API secret is required.");if(!o||"string"!=typeof o)throw new TypeError("API URL root is required.");if(null!==i&&"string"!=typeof i||"string"==typeof i&&0===i.length)throw new TypeError("Default campaign ID must be null or a valid campaign ID.");if(a){if(!s)throw new TypeError("PGP password is required when encrypt is true.");if(!u)throw new TypeError("PGP secret is required when encrypt is true.")}this._={apiKey:r,apiSecret:n,apiUrlRoot:o,campaignId:i,encrypt:a,pgpPassword:s,pgpSecret:u}}return n(e,[{key:"apiKey",get:function(){return this._.apiKey}},{key:"apiSecret",get:function(){return this._.apiSecret}},{key:"apiUrlRoot",get:function(){return this._.apiUrlRoot}},{key:"campaignId",get:function(){return this._.campaignId}},{key:"encrypt",get:function(){return this._.encrypt}},{key:"pgpPassword",get:function(){return this._.pgpPassword}},{key:"pgpSecret",get:function(){return this._.pgpSecret}}]),e}();e.exports=o},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=r(25),i=r(33),a=r(34),s=r(42),u=r(51),c=r(53),f=r(56),p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=t||null,n=new o,p=new i(n);this._={bees:new a(r,n,p),config:r,consents:new s(r,n,p),inbox:new u(r,n,p),system:new c(r,n,p),users:new f(r,n,p)}}return n(e,[{key:"bees",get:function(){return this._.bees}},{key:"config",get:function(){return this._.config},set:function(e){this._.bees.config=e,this._.consents.config=e,this._.inbox.config=e,this._.system.config=e,this._.users.config=e,this._.config=e}},{key:"consents",get:function(){return this._.consents}},{key:"inbox",get:function(){return this._.inbox}},{key:"system",get:function(){return this._.system}},{key:"users",get:function(){return this._.users}}]),e}();e.exports=p},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(26),a=r(29),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={cfg:n({},t||{}),internalCache:{}}}return o(e,[{key:"get",value:function(e,t,r,n){var o=this;if(!e)throw new TypeError("apiUrlRoot is required.");if(!t)throw new TypeError("apiKey is required.");if(!r)throw new TypeError("apiSecret is required.");if("string"!=typeof e)throw new TypeError("apiUrlRoot must be a string.");if("string"!=typeof t)throw new TypeError("apiKey must be a string.");if("string"!=typeof r)throw new TypeError("apiSecret must be a string.");var s=e+":"+t+":"+r;if(!0!==n&&s in this._.internalCache){var u=this._.internalCache[s],c=i(u).exp,f=Date.now();if(("number"==typeof c?1e3*c:f)-f>(this._.cfg.expTol||1e4))return Promise.resolve(u)}return a.getApiAccessToken({apiKey:t,apiSecret:r,apiUrlRoot:e}).then(function(e){return o._.internalCache[s]=e,e})}}]),e}();e.exports=s},function(e,t,r){"use strict";var n=r(27);function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[r]))}catch(e){throw new o("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=o},function(e,t,r){"use strict";var n=r(28);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(t)}catch(e){return n(t)}}},function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new o("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,a=0,s=0,u="";i=t.charAt(s++);~i&&(r=a%4?64*r+i:i,a++%4)?u+=String.fromCharCode(255&r>>(-2*a&6)):0)i=n.indexOf(i);return u}},function(e,t,r){"use strict";var n=r(30),o=r(1),i=r(0),a="Unable to get an API access token.",s=function e(t){var r=t.apiKey,s=t.apiSecret,u=t.apiUrlRoot,c=r+":"+s;if(c in e._.unfulfilledPromises)return e._.unfulfilledPromises[c];var f=n(u+"/get_token",{method:"POST",body:JSON.stringify({key:r,secret:s}),headers:{"Content-Type":"application/json;charset=utf-8"},timeout:3e4}).then(function(t){return delete e._.unfulfilledPromises[c],t.json().then(function(e){var r=[];if(e){if(t.ok?"string"==typeof e.errorType&&e.errorType.length>0?e.errorMessage?r.push(e.errorMessage):r.push(a):"string"==typeof e.token&&0!==e.token.trim().length||r.push(a):403===t.status?(r.push("Forbidden."),e.message&&r.push(e.message)):r.push(a),0===r.length)return e.token.trim()}else r.push(a);throw new o(r.join(" "))})}).catch(function(t){throw delete e._.unfulfilledPromises[c],i.transformError(t)});return e._.unfulfilledPromises[c]=f,f};s._={unfulfilledPromises:{}},e.exports={getApiAccessToken:s}},function(e,t,r){"use strict";(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e){function t(){this.fetch=!1}return t.prototype=e,new t}("undefined"!=typeof self?self:void 0);(function(e){!function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},o=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};f.prototype.append=function(e,t){e=s(e),t=u(t);var r=this.map[e];this.map[e]=r?r+","+t:t},f.prototype.delete=function(e){delete this.map[s(e)]},f.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},f.prototype.set=function(e,t){this.map[s(e)]=u(t)},f.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),c(e)},f.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},f.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),c(e)},t.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);var i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},y.call(g.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];v.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=f,e.Request=g,e.Response=v,e.fetch=function(e,r){return new Promise(function(n,o){var i=new g(e,r),a=new XMLHttpRequest;a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new v(o,r))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.open(i.method,i.url,!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&t.blob&&(a.responseType="blob"),i.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function f(e){this.map={},e instanceof f?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function h(e){var t=new FileReader,r=l(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!o(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=l(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(e,t){var r,n,o=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),i.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function _(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function v(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}}(void 0!==e?e:this)}).call(r,void 0);var n=r.fetch;n.Response=r.Response,n.Request=r.Request,n.Headers=r.Headers;"object"===t(e)&&e.exports&&(e.exports=n,e.exports.default=n)}).call(this,r(10)(e))},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]])}return r};Object.defineProperty(t,"__esModule",{value:!0});var s=r(11),u=r(11);t.ClientError=u.ClientError,r(32);var c=function(){function e(e,t){this.url=e,this.options=t||{}}return e.prototype.rawRequest=function(e,t){return o(this,void 0,void 0,function(){var r,o,u,c,f,l,h,d,y;return i(this,function(i){switch(i.label){case 0:return r=this.options,o=r.headers,u=a(r,["headers"]),c=JSON.stringify({query:e,variables:t||void 0}),[4,fetch(this.url,n({method:"POST",headers:Object.assign({"Content-Type":"application/json"},o),body:c},u))];case 1:return[4,p(f=i.sent())];case 2:if(l=i.sent(),f.ok&&!l.errors&&l.data)return h=f.headers,d=f.status,[2,n({},l,{headers:h,status:d})];throw y="string"==typeof l?{error:l}:l,new s.ClientError(n({},y,{status:f.status,headers:f.headers}),{query:e,variables:t})}})})},e.prototype.request=function(e,t){return o(this,void 0,void 0,function(){var r,o,u,c,f,l,h;return i(this,function(i){switch(i.label){case 0:return r=this.options,o=r.headers,u=a(r,["headers"]),c=JSON.stringify({query:e,variables:t||void 0}),[4,fetch(this.url,n({method:"POST",headers:Object.assign({"Content-Type":"application/json"},o),body:c},u))];case 1:return[4,p(f=i.sent())];case 2:if(l=i.sent(),f.ok&&!l.errors&&l.data)return[2,l.data];throw h="string"==typeof l?{error:l}:l,new s.ClientError(n({},h,{status:f.status}),{query:e,variables:t})}})})},e.prototype.setHeaders=function(e){return this.options.headers=e,this},e.prototype.setHeader=function(e,t){var r,n=this.options.headers;return n?n[e]=t:this.options.headers=((r={})[e]=t,r),this},e}();function f(e,t,r){return o(this,void 0,void 0,function(){return i(this,function(n){return[2,new c(e).request(t,r)]})})}function p(e){return o(this,void 0,void 0,function(){var t;return i(this,function(r){return(t=e.headers.get("Content-Type"))&&t.startsWith("application/json")?[2,e.json()]:[2,e.text()]})})}t.GraphQLClient=c,t.rawRequest=function(e,t,r){return o(this,void 0,void 0,function(){return i(this,function(n){return[2,new c(e).rawRequest(t,r)]})})},t.request=f,t.default=f},function(e,t,r){"use strict";!function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},o=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};f.prototype.append=function(e,t){e=s(e),t=u(t);var r=this.map[e];this.map[e]=r?r+","+t:t},f.prototype.delete=function(e){delete this.map[s(e)]},f.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},f.prototype.set=function(e,t){this.map[s(e)]=u(t)},f.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),c(e)},f.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},f.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),c(e)},t.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);var i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},y.call(g.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];v.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=f,e.Request=g,e.Response=v,e.fetch=function(e,r){return new Promise(function(n,o){var i=new g(e,r),a=new XMLHttpRequest;a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new v(o,r))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.open(i.method,i.url,!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&t.blob&&(a.responseType="blob"),i.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function f(e){this.map={},e instanceof f?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function h(e){var t=new FileReader,r=l(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!o(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=l(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(e,t){var r,n,o=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),i.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function _(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function v(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:void 0)},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=r(12),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:t,internalCache:{}}}return n(e,[{key:"get",value:function(e,t,r,n){var i=this,a=t+":"+r;if(!0!==n&&a in this._.internalCache){var s=this._.internalCache[a];return Promise.resolve(s)}return this._.apiAccessTokenCache.get(e,t,r).then(function(n){return o.getUser(e,n).then(function(e){return i._.internalCache[a]=e,e}).catch(function(){return i._.apiAccessTokenCache.get(e,t,r,!0).then(function(t){return o.getUser(e,t).then(function(e){return i._.internalCache[a]=e,e})})})})}}]),e}();e.exports=i},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(0),a=r(35),s=r(13),u=r(6),c=r(2),f=r(14),p=r(4),l=r(5),h=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:r,config:t||null,usersCache:n}}return n(e,[{key:"_assertValidState",value:function(){if(!this._.config)throw TypeError("Illegal State: Default config has not been set yet.")}},{key:"listBees",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var n,o,s,u,c,f,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.apiKey,o=t.apiSecret,s=t.apiUrlRoot,u=r.after,c=r.limit,f=r.searchText,e.next=4,i._.apiAccessTokenCache.get(s,n,o);case 4:return p=e.sent,e.next=7,a.bees(s,p,f,u,c);case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),r=p.resolveApiCfg(u,this._.config),n={searchText:s},e.abrupt("return",p.startPaging(t,r,n));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"takeOff",value:function(){var e=o(regeneratorRuntime.mark(function e(t,r,n){var o,a,u,f,h,d,y,g,_,v,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(d in this._assertValidState(),o=p.resolveApiCfg(m,this._.config),a=o.apiKey,u=o.apiSecret,f=o.apiUrlRoot,h={filenames:r.process.fileNames,user_reference:r.process.userReference||null},n&&(h.subscriptions=n),Array.isArray(r.process.destinations)&&r.process.destinations.length>0&&(h.destinations=r.process.destinations.map(function(e){return i.appearsToBeAnEmailAddress(e)?{email:e}:{xcoobee_id:e}})),h.bees=[],t)"transfer"!==d&&(y=t[d],h.bees.push({bee_name:d,params:JSON.stringify(y)}));return e.prev=8,e.next=11,this._.apiAccessTokenCache.get(f,a,u);case 11:return g=e.sent,e.next=14,s.addDirective(f,g,h);case 14:return _=e.sent,v=new l({ref_id:_}),e.abrupt("return",v);case 19:throw e.prev=19,e.t0=e.catch(8),new c(400,e.t0);case 22:case"end":return e.stop()}},e,this,[[8,19]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"uploadFiles",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,h,d,y,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.OUTBOX,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=p.resolveApiCfg(_,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(i,n,o);case 6:return a=e.sent,e.next=9,this._.usersCache.get(i,n,o);case 9:return s=e.sent,h=s.cursor,e.next=13,f.upload(i,a,h,g,t);case 13:return d=e.sent,y=new l(d),e.abrupt("return",y);case 18:throw e.prev=18,e.t0=e.catch(3),new c(400,e.t0);case 21:case"end":return e.stop()}},e,this,[[3,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"config",set:function(e){this._.config=e}}]),e}();e.exports=h},function(e,t,r){"use strict";var n=r(0);e.exports={bees:function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return n.createClient(e,t).request("\n    query getBees($searchText: String, $after: String, $first: Int) {\n      bees(search: $searchText, after: $after, first: $first) {\n        data {\n          bee_icon\n          bee_system_name\n          category\n          cursor\n          date_c,\n          description\n          input_extensions\n          input_file_types\n          is_file_reader\n          label\n          max_filesize\n          output_extensions\n          output_file_types\n          owner_cursor\n          owner_xcoobee_id\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:o,first:i,searchText:r}).then(function(e){return e.bees}).catch(function(e){throw n.transformError(e)})}}},function(e,t,r){"use strict";var n,o,i=(n=regeneratorRuntime.mark(function e(t,r,n,o,i){var u,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.outbox_endpoints(t,r,n);case 2:if(u=e.sent,c=u.data,!(f=c.filter(function(e){return[o,i].includes(e.name)})).length){e.next=7;break}return e.abrupt("return",f[0]);case 7:throw new s("Unable to find an endpoint named "+o+" or the fallback end point.");case 8:case"end":return e.stop()}},e,this)}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e,t,r,n,i){return o.apply(this,arguments)});var a=r(37),s=r(1);e.exports={findEndPoint:i}},function(e,t,r){"use strict";var n=r(0);e.exports={outbox_endpoints:function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return n.createClient(e,t).request("\n    query getOutboxEndpoints($userCursor: String!) {\n      outbox_endpoints(user_cursor: $userCursor) {\n        data {\n          cursor\n          date_c\n          name\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:o,first:i,userCursor:r}).then(function(e){return e.outbox_endpoints}).catch(function(e){throw n.transformError(e)})}}},function(e,t,r){"use strict";var n=r(8),o=r(39),i=r(1),a=r(0);e.exports={upload_file:function(e,t){var r=t.upload_url,s=new o;return s.append("key",t.key),s.append("acl","private"),s.append("X-Amz-Algorithm","AWS4-HMAC-SHA256"),s.append("X-Amz-Credential",t.credential),s.append("X-Amz-Date",t.date),s.append("X-Amz-meta-identifier",t.identifier),s.append("Policy",t.policy),s.append("X-Amz-Signature",t.signature),"function"==typeof File&&e instanceof File?s.append("file",e):s.append("file",n.createReadStream(e)),new Promise(function(n){var o=function(r,o,s){if(r)throw a.transformError(r);if(s>=300)throw new i("Failed to upload file at: "+e+" using policy: "+JSON.stringify(t));n(o)};if("function"==typeof s.submit)s.submit(r,function(e,t){return o(e,t,t.statusCode)});else{var u=new XMLHttpRequest;u.onreadystatechange=function(){4===u.readyState&&o(null,u.responseText,u.status)},u.open("POST",r),u.send(s)}})}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports="object"==("undefined"==typeof self?"undefined":n(self))?self.FormData:window.FormData},function(e,t,r){"use strict";var n=r(8),o=r(0),i=r(6);e.exports={upload_policy:function(e,t,r,a,s){if(!i.values.includes(r))throw new TypeError("'intent' must be one of "+i.values.join(", ")+".");if(!o.appearsToBeACursor(a))throw new TypeError("`endPointCursor` is required.");if(!Array.isArray(s))throw new TypeError("`files` must be an array.");var u=["query uploadPolicy {"];return s.forEach(function(e,t){var o=void 0;o="function"==typeof File&&e instanceof File?e.name:n.basename(e),u.push("  policy"+t+': upload_policy(filePath: "'+o+'", intent: '+r+', identifier: "'+a+'") {'),u.push("    credential"),u.push("    date"),u.push("    identifier"),u.push("    key"),u.push("    policy"),u.push("    signature"),u.push("    upload_url"),u.push("  }")}),u.push("}"),u=u.join("\n"),o.createClient(e,t).request(u).then(function(e){for(var t=[],r=0,n=s.length;r<n;++r){var o=null,i="policy"+r;e[i]&&(o=e[i]),t.push(o)}return t}).catch(function(e){throw o.transformError(e)})}}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(2),a=r(7),s=function(e){function t(e,r,n,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{apiCfg:n,code:200,currentPage:r,error:null,fetcher:e,hasNextPage:r.page_info.has_next_page,params:o,result:r}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"getNextPage",value:function(){var e,r=(e=regeneratorRuntime.mark(function e(){var r,o,a,s,u,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasNextPage()){e.next=13;break}return r=this._,o=r.apiCfg,a=r.currentPage,s=r.fetcher,u=r.params,c=n({},u,{after:a.page_info.end_cursor}),e.prev=3,e.next=6,this._.fetcher(o,c);case 6:return f=e.sent,e.abrupt("return",new t(s,f,o,u));case 10:throw e.prev=10,e.t0=e.catch(3),new i(400,e.t0);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this,[[3,10]])}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(){return r.apply(this,arguments)}}()}]),t}();e.exports=s},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(8),a=r(15),s=r(43),u=r(16),c=r(13),f=r(6),p=r(1),l=r(2),h=r(14),d=r(4),y=r(5),g=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:r,config:t||null,usersCache:n}}return n(e,[{key:"_assertValidState",value:function(){if(!this._.config)throw TypeError("Illegal State: Default config has not been set yet.")}},{key:"confirmConsentChange",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveApiCfg(f,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(i,n,o);case 6:return a=e.sent,e.next=9,s.confirmConsentChange(i,a,t);case 9:return u=e.sent,c=new y(u),e.abrupt("return",c);case 14:throw e.prev=14,e.t0=e.catch(3),new l(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"confirmDataDelete",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveApiCfg(f,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(i,n,o);case 6:return a=e.sent,e.next=9,s.confirmDataDelete(i,a,t);case 9:return u=e.sent,c=new y(u),e.abrupt("return",c);case 14:throw e.prev=14,e.t0=e.catch(3),new l(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getCampaignInfo",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n,o,i,s,u,c,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=d.resolveCampaignId(f,p,this._.config),r=d.resolveApiCfg(p,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(i,n,o);case 7:return s=e.sent,e.next=10,a.getCampaignInfo(i,s,t);case 10:return u=e.sent,c=new y(u),e.abrupt("return",c);case 15:throw e.prev=15,e.t0=e.catch(4),new l(400,e.t0);case 18:case"end":return e.stop()}},e,this,[[4,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"getConsentData",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveApiCfg(f,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(i,n,o);case 6:return a=e.sent,e.next=9,s.getConsentData(i,a,t);case 9:return u=e.sent,c=new y(u),e.abrupt("return",c);case 14:throw e.prev=14,e.t0=e.catch(3),new l(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getCookieConsent",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f,p,h,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveCampaignId(g,_,this._.config),n=d.resolveApiCfg(_,this._.config),o=n.apiKey,i=n.apiSecret,a=n.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(a,o,i);case 7:return u=e.sent,e.next=10,this._.usersCache.get(a,o,i);case 10:return c=e.sent,f=c.cursor,e.next=14,s.getCookieConsent(a,u,t,f,r);case 14:return p=e.sent,h=new y(p),e.abrupt("return",h);case 19:throw e.prev=19,e.t0=e.catch(4),new l(400,e.t0);case 22:case"end":return e.stop()}},e,this,[[4,19]])}));return function(t){return e.apply(this,arguments)}}()},{key:"listCampaigns",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var o,i,s,u,c,f,p,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.apiKey,i=t.apiSecret,s=t.apiUrlRoot,u=r.after,c=r.limit,e.next=4,n._.apiAccessTokenCache.get(s,o,i);case 4:return f=e.sent,e.next=7,n._.usersCache.get(s,o,i);case 7:return p=e.sent,l=p.cursor,e.next=11,a.getCampaigns(s,f,l,u,c);case 11:return h=e.sent,e.abrupt("return",h);case 13:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}(),r=d.resolveApiCfg(i,this._.config),e.abrupt("return",d.startPaging(t,r,{}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listConsents",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var n,o,a,u,c,f,p,l,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.apiKey,o=t.apiSecret,a=t.apiUrlRoot,u=r.after,c=r.limit,f=r.statuses,e.next=4,i._.apiAccessTokenCache.get(a,n,o);case 4:return p=e.sent,e.next=7,i._.usersCache.get(a,n,o);case 7:return l=e.sent,h=l.cursor,e.next=11,s.listConsents(a,p,h,f,u,c);case 11:return d=e.sent,e.abrupt("return",d);case 13:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n=d.resolveApiCfg(a,this._.config),e.abrupt("return",d.startPaging(r,n,{statuses:t||[]}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestConsent",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveCampaignId(h,g,this._.config),n=d.resolveApiCfg(g,this._.config),o=n.apiKey,i=n.apiSecret,a=n.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(a,o,i);case 7:return u=e.sent,e.next=10,s.requestConsent(a,u,t,r,p);case 10:return c=e.sent,f=new y(c),e.abrupt("return",f);case 15:throw e.prev=15,e.t0=e.catch(4),new l(400,e.t0);case 18:case"end":return e.stop()}},e,this,[[4,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setUserDataResponse",value:function(){var e=o(regeneratorRuntime.mark(function e(t,r,n,o){var a,g,_,v,m,b,w,x,E,C,S,T,A,R,I,O,k,P,U,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),a=d.resolveApiCfg(N,this._.config),g=a.apiKey,_=a.apiSecret,v=a.apiUrlRoot,m=[],b=[],w=void 0,e.prev=6,e.next=9,this._.apiAccessTokenCache.get(v,g,_);case 9:return x=e.sent,e.next=12,this._.usersCache.get(v,g,_);case 12:return E=e.sent,C=E.cursor,e.next=16,u.sendUserMessage(v,x,t,{consentId:r});case 16:if(b.push("successfully sent message"),S={progress:b,ref_id:null},!n||!o){e.next=36;break}return T=f.OUTBOX,e.next=22,h.upload(v,x,C,T,[o]);case 22:if(A=e.sent,R=[],A.forEach(function(e){var t=e.error,r=e.file;e.success?(R.push(r),b.push("successfully uploaded "+r)):(m.push("Failed to upload file: "+r+". Error: "+t+"."),b.push("failed upload on "+r))}),!(R.length>0)){e.next=36;break}return e.next=28,s.resolveXcoobeeId(v,x,r);case 28:return I=e.sent,O=R.map(function(e){return i.basename(e)}),k={destinations:[{xcoobee_id:I}],filenames:O,user_reference:n},e.next=33,c.addDirective(v,x,k);case 33:P=e.sent,b.push("successfully sent successfully uploaded file"+(1===R.length?"":"s")+" to destination"),S.ref_id=P;case 36:w=new y(S),e.next=42;break;case 39:e.prev=39,e.t0=e.catch(6),m.push(e.t0.message);case 42:if(!(m.length>0)){e.next=45;break}throw U=m.join(" "),new l(400,new p(U));case 45:return e.abrupt("return",w);case 46:case"end":return e.stop()}},e,this,[[6,39]])}));return function(t,r,n,o){return e.apply(this,arguments)}}()},{key:"getDataPackage",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f,p,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=d.resolveSdkCfg(h,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,a=r.pgpPassword,u=r.pgpSecret,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(i,n,o);case 6:return c=e.sent,e.next=9,s.getDataPackage(i,c,t,u,a);case 9:return f=e.sent,p=new y(f),e.abrupt("return",p);case 14:throw e.prev=14,e.t0=e.catch(3),new l(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"config",set:function(e){this._.config=e}}]),e}();e.exports=g},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=r(1),i=r(0),a=r(44),s=r(45),u=r(46),c=r(9).decryptWithEncryptedPrivateKey;e.exports={confirmConsentChange:function(e,t,r){return i.createClient(e,t).request("\n    mutation confirmConsentChange($consentCursor: String!) {\n      confirm_consent_change(consent_cursor: $consentCursor) {\n        consent_cursor\n      }\n    }\n  ",{consentCursor:r}).then(function(e){return{confirmed:e.confirm_consent_change.consent_cursor===r}}).catch(function(e){throw i.transformError(e)})},confirmDataDelete:function(e,t,r){return i.createClient(e,t).request("\n    mutation confirmDataDelete($consentCursor: String!) {\n      confirm_consent_deletion(consent_cursor: $consentCursor) {\n        consent_cursor\n      }\n    }\n  ",{consentCursor:r}).then(function(e){return{confirmed:e.confirm_consent_deletion.consent_cursor===r}}).catch(function(e){throw i.transformError(e)})},getCookieConsent:function(e,t,r,c,f){i.assertAppearsToBeACampaignId(f);return i.createClient(e,t).request("\n    query getCookieConsent($userCursor: String!, $campaignIds: [String!]!, $statuses: [ConsentStatus]) {\n      consents(campaign_owner_cursor: $userCursor, campaign_cursors: $campaignIds, statuses: $statuses) {\n        data {\n          consent_type,\n          request_data_types,\n          user_xcoobee_id,\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{campaignIds:[f],statuses:[s.ACTIVE],userCursor:c}).then(function(e){var t,i=e.consents,s=i.data;if(i.page_info.has_next_page)throw o("Too many active consents to be able to determine cookie consents. Please notify XcooBee of this issue.");var c=(n(t={},a.ADVERTISING_COOKIE,!1),n(t,a.APPLICATION_COOKIE,!1),n(t,a.STATISTICS_COOKIE,!1),n(t,a.USAGE_COOKIE,!1),t);return s.forEach(function(e){e.user_xcoobee_id===r&&[u.WEB_APPLICATION_TRACKING,u.WEBSITE_TRACKING].includes(e.consent_type)&&(e.request_data_types.includes(a.ADVERTISING_COOKIE)&&(c[a.ADVERTISING_COOKIE]=!0),e.request_data_types.includes(a.APPLICATION_COOKIE)&&(c[a.APPLICATION_COOKIE]=!0),e.request_data_types.includes(a.STATISTICS_COOKIE)&&(c[a.STATISTICS_COOKIE]=!0),e.request_data_types.includes(a.USAGE_COOKIE)&&(c[a.USAGE_COOKIE]=!0))}),{cookie_consents:c}}).catch(function(e){throw i.transformError(e)})},getConsentData:function(e,t,r){return i.createClient(e,t).request("\n    query getConsentData($consentCursor: String!) {\n      consent(consent_cursor: $consentCursor) {\n        consent_description\n        consent_details {\n          datatype\n        }\n        consent_name\n        consent_status\n        consent_type\n        date_c\n        date_e\n        request_data_types\n        request_owner\n        required_data_types\n        user_cursor\n        user_display_name\n        user_xcoobee_id\n      }\n    }\n  ",{consentCursor:r}).then(function(e){return{consent:e.consent}}).catch(function(e){throw i.transformError(e)})},listConsents:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!Array.isArray(n))throw TypeError("`statuses` should be array");n.forEach(function(e){if("string"==typeof e&&!s.values.includes(e))throw TypeError("Invalid consent status: "+e+".  Must be one of "+s.values.join(", ")+".")});return i.createClient(e,t).request("\n    query listConsents($userCursor: String!, $statuses: [ConsentStatus], $after: String, $first: Int) {\n      consents(campaign_owner_cursor: $userCursor, statuses: $statuses, after: $after, first: $first) {\n        data {\n          consent_cursor,\n          consent_status,\n          date_c,\n          date_e,\n          user_xcoobee_id,\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:o,first:a,statuses:n.length?n:null,userCursor:r}).then(function(e){return e.consents}).catch(function(e){throw i.transformError(e)})},resolveXcoobeeId:function(e,t,r){return i.createClient(e,t).request("\n    query resolveXcoobeeId($consentCursor: String!) {\n      consent(consent_cursor: $consentCursor) {\n        user_xcoobee_id\n      }\n    }\n  ",{consentCursor:r}).then(function(e){return e.consent.user_xcoobee_id}).catch(function(e){throw i.transformError(e)})},requestConsent:function(e,t,r,n,o){return i.createClient(e,t).request("\n    mutation requestConsent($config: AdditionalRequestConfig) {\n      send_consent_request(config: $config) {\n        ref_id\n      }\n    }\n  ",{config:{campaign_cursor:n,reference:o,xcoobee_id:r}}).then(function(e){return{ref_id:e.send_consent_request.ref_id}}).catch(function(e){throw i.transformError(e)})},getDataPackage:function(e,t,r,n,o){var a,s;return i.createClient(e,t).request("\n    query getDataPackage($consentId: String!) {\n      data_package(consent_cursor: $consentId) {\n          data\n      }\n    }\n  ",{consentId:r}).then((a=regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!o){e.next=5;break}return e.next=3,c(t.data_package.data,n,o);case 3:return r=e.sent,e.abrupt("return",{payload:JSON.parse(r)});case 5:return e.abrupt("return",{payload:t.data_package&&t.data_package.data});case 6:case"end":return e.stop()}},e,void 0)}),s=function(){var e=a.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})},function(e){return s.apply(this,arguments)})).catch(function(e){throw i.transformError(e)})}}},function(e,t,r){"use strict";var n=Object.freeze(["advertising_cookie","alternate_email","alternate_phone","application_cookie","bank_accounts","biometric_data","browser_details","city","colleagues","country","criminal_conviction","custom","date_of_birth","dental_record","device_identifiers","email","emergency_medical_record","ethnicity_race","family_members","first_name","friends","genetic_data","government_document_references","government_id","health_metrics","health_record","image","internet_access_record","ip_address","last_name","location_data","membership","mental_health_record","meter_reading","middle_name","name_prefix","name_suffix","other1","other2","other3","other4","other5","other6","other7","other8","other9","party_affiliation","phone","physical_health_record","religion","sexual_orientation","social_posts","state","statistics_cookie","street1","street2","twitter_handle","usage_cookie","xcoobee_id"]),o=Object.freeze({ADVERTISING_COOKIE:"advertising_cookie",ALTERNATE_EMAIL:"alternate_email",ALTERNATE_PHONE:"alternate_phone",APPLICATION_COOKIE:"application_cookie",BANK_ACCOUNTS:"bank_accounts",BIOMETRIC_DATA:"biometric_data",BROWSER_DETAILS:"browser_details",CITY:"city",COLLEAGUES:"colleagues",COUNTRY:"country",CRIMINAL_CONVICTION:"criminal_conviction",CUSTOM:"custom",DATE_OF_BIRTH:"date_of_birth",DENTAL_RECORD:"dental_record",DEVICE_IDENTIFIERS:"device_identifiers",EMAIL:"email",EMERGENCY_MEDICAL_RECORD:"emergency_medical_record",ETHNICITY_RACE:"ethnicity_race",FAMILY_MEMBERS:"family_members",FIRST_NAME:"first_name",FRIENDS:"friends",GENETIC_DATA:"genetic_data",GOVERNMENT_DOCUMENT_REFERENCES:"government_document_references",GOVERNMENT_ID:"government_id",HEALTH_METRICS:"health_metrics",HEALTH_RECORD:"health_record",IMAGE:"image",INTERNET_ACCESS_RECORD:"internet_access_record",IP_ADDRESS:"ip_address",LAST_NAME:"last_name",LOCATION_DATA:"location_data",MEMBERSHIP:"membership",MENTAL_HEALTH_RECORD:"mental_health_record",METER_READING:"meter_reading",MIDDLE_NAME:"middle_name",NAME_PREFIX:"name_prefix",NAME_SUFFIX:"name_suffix",OTHER1:"other1",OTHER2:"other2",OTHER3:"other3",OTHER4:"other4",OTHER5:"other5",OTHER6:"other6",OTHER7:"other7",OTHER8:"other8",OTHER9:"other9",PARTY_AFFILIATION:"party_affiliation",PHONE:"phone",PHYSICAL_HEALTH_RECORD:"physical_health_record",RELIGION:"religion",SEXUAL_ORIENTATION:"sexual_orientation",SOCIAL_POSTS:"social_posts",STATE:"state",STATISTICS_COOKIE:"statistics_cookie",STREET1:"street1",STREET2:"street2",TWITTER_HANDLE:"twitter_handle",USAGE_COOKIE:"usage_cookie",XCOOBEE_ID:"xcoobee_id",values:n});e.exports=o},function(e,t,r){"use strict";var n=Object.freeze(["active","canceled","expired","pending","offer","rejected","updating"]),o=Object.freeze({ACTIVE:"active",CANCELED:"canceled",EXPIRED:"expired",PENDING:"pending",OFFER:"offer",REJECTED:"rejected",UPDATING:"updating",values:n});e.exports=o},function(e,t,r){"use strict";var n=Object.freeze(["anonymized_data_aggregation","billing","care_delivery","company_information","contractor_management","create_custom_product","create_custom_service","create_custom_service_and_product","data_aggregation","deliver_a_product","deliver_itiniary_changes","emergency_request","emergency_services","employee_administration","employee_management","financial_reports","government_services","health_billing","health_care_services","iot_device_tracking","it_administration","law_enforcement","marketing","missing","mobile_device_tracking","order_fullfillment","other","perform_a_service","perform_contract","press_releaseases","private_consent","product_announcement","product_information","promotion","shipping","supplier_screening","support","support_a_product","support_a_service","survey","training","travel","web_application_tracking","website_tracking"]),o=Object.freeze({ANONYMIZED_DATA_AGGREGATION:"anonymized_data_aggregation",BILLING:"billing",CARE_DELIVERY:"care_delivery",COMPANY_INFORMATION:"company_information",CONTRACTOR_MANAGEMENT:"contractor_management",CREATE_CUSTOM_PRODUCT:"create_custom_product",CREATE_CUSTOM_SERVICE:"create_custom_service",CREATE_CUSTOM_SERVICE_AND_PRODUCT:"create_custom_service_and_product",DATA_AGGREGATION:"data_aggregation",DELIVER_A_PRODUCT:"deliver_a_product",DELIVER_ITINIARY_CHANGES:"deliver_itiniary_changes",EMERGENCY_REQUEST:"emergency_request",EMERGENCY_SERVICES:"emergency_services",EMPLOYEE_ADMINISTRATION:"employee_administration",EMPLOYEE_MANAGEMENT:"employee_management",FINANCIAL_REPORTS:"financial_reports",GOVERNMENT_SERVICES:"government_services",HEALTH_BILLING:"health_billing",HEALTH_CARE_SERVICES:"health_care_services",IOT_DEVICE_TRACKING:"iot_device_tracking",IT_ADMINISTRATION:"it_administration",LAW_ENFORCEMENT:"law_enforcement",MARKETING:"marketing",MISSING:"missing",MOBILE_DEVICE_TRACKING:"mobile_device_tracking",ORDER_FULLFILLMENT:"order_fullfillment",OTHER:"other",PERFORM_A_SERVICE:"perform_a_service",PERFORM_CONTRACT:"perform_contract",PRESS_RELEASEASES:"press_releaseases",PRIVATE_CONSENT:"private_consent",PRODUCT_ANNOUNCEMENT:"product_announcement",PRODUCT_INFORMATION:"product_information",PROMOTION:"promotion",SHIPPING:"shipping",SUPPLIER_SCREENING:"supplier_screening",SUPPORT:"support",SUPPORT_A_PRODUCT:"support_a_product",SUPPORT_A_SERVICE:"support_a_service",SURVEY:"survey",TRAINING:"training",TRAVEL:"travel",WEB_APPLICATION_TRACKING:"web_application_tracking",WEBSITE_TRACKING:"website_tracking",values:n});e.exports=o},function(e,t,r){"use strict";var n,o=r(48),i=null;t.fetchOpenpgp=(n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){i?e(i):o("https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.4.9/openpgp.min.js").then(function(r){if(window.openpgp)(i=window.openpgp).initWorker({path:"https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.4.9/openpgp.worker.min.js"}),e(i);else{var n=Error("Failed to load OpenPgp Checkout library.");t(n)}})}));case 1:case"end":return e.stop()}},e,void 0)}),function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,i){try{var a=e[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})})},function(e,t,r){"use strict";var n=r(49),o=function(e,t){"function"==typeof t&&(cb=t,t={});var r=function(e){return function(r,o){n(e,t,function(e,t){e?o(e):r(t)})}};if(e instanceof Array){var o=e.map(function(e){return new Promise(r(e))});return Promise.all(o)}return new Promise(r(e))};e.exports=o,e.exports.ifNotLoaded=function(e){return{loadScript:document.querySelector('script[src*="'+e+'"]')?function(){}:o}}},function(e,t,r){"use strict";function n(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function o(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}e.exports=function(e,t,r){var i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");"function"==typeof t&&(r=t,t={}),t=t||{},r=r||function(){},a.type=t.type||"text/javascript",a.charset=t.charset||"utf8",a.async=!("async"in t)||!!t.async,a.src=e,t.attrs&&function(e,t){for(var r in t)e.setAttribute(r,t[r])}(a,t.attrs),t.text&&(a.text=""+t.text),("onload"in a?n:o)(a,r),a.onload||n(a,r),i.appendChild(a)}},function(e,t,r){"use strict";var n=Object.freeze(["breach","broadcast","complaint","consent","data_request","ticket"]),o=Object.freeze({BREACH:"breach",BROADCAST:"broadcast",COMPLAINT:"complaint",CONSENT:"consent",DATA_REQUEST:"data_request",TICKET:"ticket",values:n});e.exports=o},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(52),a=r(2),s=r(4),u=r(5),c=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:r,config:t||null,usersCache:n}}return n(e,[{key:"_assertValidState",value:function(){if(!this._.config)throw TypeError("Illegal State: Default config has not been set yet.")}},{key:"deleteInboxItem",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,c,f,p,l,h,d,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=s.resolveApiCfg(y,this._.config),n=r.apiKey,o=r.apiSecret,c=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(c,n,o);case 6:return f=e.sent,e.next=9,this._.usersCache.get(c,n,o);case 9:return p=e.sent,l=p.cursor,e.next=13,i.deleteInboxItem(c,f,l,t);case 13:return h=e.sent,d=new u(h),e.abrupt("return",d);case 18:throw e.prev=18,e.t0=e.catch(3),new a(400,e.t0);case 21:case"end":return e.stop()}},e,this,[[3,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboxItem",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,c,f,p,l,h,d,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=s.resolveApiCfg(y,this._.config),n=r.apiKey,o=r.apiSecret,c=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(c,n,o);case 6:return f=e.sent,e.next=9,this._.usersCache.get(c,n,o);case 9:return p=e.sent,l=p.cursor,e.next=13,i.getInboxItem(c,f,l,t);case 13:return h=e.sent,d=new u(h),e.abrupt("return",d);case 18:throw e.prev=18,e.t0=e.catch(3),new a(400,e.t0);case 21:case"end":return e.stop()}},e,this,[[3,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"listInbox",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var o,a,s,u,c,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.apiKey,a=t.apiSecret,s=t.apiUrlRoot,u=r.after,c=r.limit,e.next=4,n._.apiAccessTokenCache.get(s,o,a);case 4:return f=e.sent,e.next=7,i.listInbox(s,f,u,c);case 7:return p=e.sent,e.abrupt("return",p);case 9:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}(),r=s.resolveApiCfg(a,this._.config),e.abrupt("return",s.startPaging(t,r,{}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"config",set:function(e){this._.config=e}}]),e}();e.exports=c},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(0);e.exports={deleteInboxItem:function(e,t,r,n){return o.createClient(e,t).request("\n    mutation deleteInboxItem($userCursor: String!, $messageId: String!) {\n      remove_inbox_item(user_cursor: $userCursor, filename: $messageId) {\n        trans_id\n      }\n    }\n  ",{userCursor:r,messageId:n}).then(function(){return!0}).catch(function(e){throw o.transformError(e)})},getInboxItem:function(e,t,r,n){return o.createClient(e,t).request("\n    query getInboxItem($userCursor: String!, $messageId: String!) {\n      inbox_item(user_cursor: $userCursor, filename: $messageId) {\n        download_link\n        info {\n          date\n          downloaded\n          filename\n          file_size\n          file_tags\n          file_type\n          from\n          from_xcoobee_id\n          original_name\n          sender {\n            from\n            from_xcoobee_id\n            name\n            photo_url\n            validation_score\n          }\n          trans_id\n          trans_name\n          user_ref\n        }\n      }\n    }\n  ",{messageId:n,userCursor:r}).then(function(e){return{inbox_item:e.inbox_item}}).catch(function(e){throw o.transformError(e)})},listInbox:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.createClient(e,t).request("\n    query listInbox($after: String, $first: Int) {\n      inbox(after: $after, first: $first) {\n        data {\n          date\n          downloaded\n          file_size\n          filename\n          original_name\n          sender {\n            from\n            from_xcoobee_id\n            name\n            validation_score\n          }\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:r,first:i}).then(function(e){var t=e.inbox,r=t.page_info;return{data:t.data.map(function(e){return{messageId:e.filename,fileName:e.original_name,fileSize:e.file_size,sender:n({},e.sender),receiptDate:e.date,downloadDate:e.downloaded,expirationDate:e.date}}),page_info:r}}).catch(function(e){throw o.transformError(e)})}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(54),a=r(15),s=r(55),u=r(19),c=r(1),f=r(9).decryptWithEncryptedPrivateKey,p=r(2),l=r(4),h=r(5),d=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:r,config:t||null,usersCache:n}}return n(e,[{key:"_assertValidState",value:function(){if(!this._.config)throw TypeError("Illegal State: Default config has not been set yet.")}},{key:"addEventSubscription",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,c,f,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=l.resolveCampaignId(d,y,this._.config),n=l.resolveApiCfg(y,this._.config),o=n.apiKey,i=n.apiSecret,a=n.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(a,o,i);case 7:return s=e.sent,e.next=10,u.addEventSubscription(a,s,t,r);case 10:return c=e.sent,f=new h(c),e.abrupt("return",f);case 15:throw e.prev=15,e.t0=e.catch(4),new p(400,e.t0);case 18:case"end":return e.stop()}},e,this,[[4,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteEventSubscription",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,c,f,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=l.resolveCampaignId(d,y,this._.config),n=l.resolveApiCfg(y,this._.config),o=n.apiKey,i=n.apiSecret,a=n.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(a,o,i);case 7:return s=e.sent,e.next=10,u.deleteEventSubscription(a,s,t,r);case 10:return c=e.sent,f=new h(c),e.abrupt("return",f);case 15:throw e.prev=15,e.t0=e.catch(4),new p(400,e.t0);case 18:case"end":return e.stop()}},e,this,[[4,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getEvents",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var o,i,a,u,c,f,p,l,h,d,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.apiKey,i=t.apiSecret,a=t.apiUrlRoot,u=t.pgpPassword,c=t.pgpSecret,f=r.after,p=r.limit,e.next=4,n._.apiAccessTokenCache.get(a,o,i);case 4:return l=e.sent,e.next=7,n._.usersCache.get(a,o,i);case 7:return h=e.sent,d=h.cursor,e.next=11,s.getEvents(a,l,d,c,u,f,p);case 11:return y=e.sent,e.abrupt("return",y);case 13:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}(),r=l.resolveSdkCfg(i,this._.config),e.abrupt("return",l.startPaging(t,r,{}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"triggerEvent",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,c,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=l.resolveCampaignId(null,f,this._.config),n=l.resolveApiCfg(f,this._.config),o=n.apiKey,i=n.apiSecret,a=n.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(a,o,i);case 7:return u=e.sent,e.next=10,s.triggerEvent(a,u,r,t);case 10:return c=e.sent,e.abrupt("return",new h(c));case 14:throw e.prev=14,e.t0=e.catch(4),new p(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[4,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"listEventSubscriptions",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n,i=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var n,o,a,s,c,f,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.apiKey,o=t.apiSecret,a=t.apiUrlRoot,s=r.after,c=r.limit,f=r.resolvedCampaignId,e.next=4,i._.apiAccessTokenCache.get(a,n,o);case 4:return p=e.sent,e.next=7,u.listEventSubscriptions(a,p,f,s,c);case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),r=l.resolveApiCfg(s,this._.config),n={resolvedCampaignId:l.resolveCampaignId(a,s,this._.config)},e.abrupt("return",l.startPaging(t,r,n));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ping",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n,o,i,s,u,f,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=l.resolveCampaignId(null,d,this._.config),r=l.resolveApiCfg(d,this._.config),n=r.apiKey,o=r.apiSecret,i=r.apiUrlRoot,e.prev=4,e.next=7,this._.apiAccessTokenCache.get(i,n,o);case 7:return s=e.sent,e.next=10,this._.usersCache.get(i,n,o);case 10:if(u=e.sent,!u.pgp_public_key){e.next=19;break}return e.next=15,a.getCampaignInfo(i,s,t);case 15:if(!(f=e.sent)||!f.campaign){e.next=18;break}return e.abrupt("return",new h(!0));case 18:throw new c("Campaign not found.");case 19:throw new c("PGP key not found.");case 22:throw e.prev=22,e.t0=e.catch(4),new p(400,e.t0);case 25:case"end":return e.stop()}},e,this,[[4,22]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleEvents",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,a,s,u,p,h,d,y,g,_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(t).length){e.next=2;break}throw new TypeError("At least one handler should be passed");case 2:if(null===v||null===m){e.next=24;break}return r=m["XBEE-SIGNATURE"]||m["xbee-signature"]||null,n=m["XBEE-HANDLER"]||m["xbee-handler"]||null,o=l.resolveSdkCfg(null,this._.config),a=o.apiKey,s=o.apiSecret,u=o.apiUrlRoot,p=o.pgpPassword,h=o.pgpSecret,e.next=9,this._.usersCache.get(u,a,s);case 9:if(d=e.sent,i(v,d.xcoobee_id).toString()===r){e.next=13;break}throw new c("Invalid signature");case 13:return y={payload:v,handler:n},e.prev=14,e.next=17,f(v,h,p);case 17:g=e.sent,y.payload=JSON.parse(g),e.next=23;break;case 21:e.prev=21,e.t0=e.catch(14);case 23:_.push(y);case 24:return e.abrupt("return",Promise.all(_.map(function(e){if(!e.handler||"function"!=typeof t[e.handler])throw new c("Handler '"+e.handler+"' is not defined");return t[e.handler](e.payload)})));case 25:case"end":return e.stop()}},e,this,[[14,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"config",set:function(e){this._.config=e}}]),e}();e.exports=d},function(e,t,r){"use strict";var n,o,i,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){return e.HmacSHA1},"object"===s(t)?e.exports=t=a(r(3),r(17),r(18)):(o=[r(3),r(17),r(18)],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i))},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(9).decryptWithEncryptedPrivateKey,a=r(19).toEventType,s=r(0);e.exports={getEvents:function(e,t,r,a,u){var c,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return s.createClient(e,t).request("\n    query getEvents($userCursor: String!, $after: String, $first: Int) {\n      events(user_cursor: $userCursor, after: $after, first: $first) {\n        data {\n          date_c\n          event_id\n          event_type\n          hmac\n          owner_cursor\n          payload\n          reference_cursor\n          reference_type\n        }\n        page_info {\n          end_cursor\n          has_next_page\n        }\n      }\n    }\n  ",{after:f,first:p,userCursor:r}).then((c=o(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.events,!a||!u){e.next=5;break}return e.next=4,Promise.all(r.data.map(function(){var e=o(regeneratorRuntime.mark(function e(t){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t.payload,a,u);case 2:return r=e.sent,o=JSON.parse(r),e.abrupt("return",n({},t,{payload:o}));case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()));case 4:r.data=e.sent;case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},e,void 0)})),function(e){return c.apply(this,arguments)})).catch(function(e){throw s.transformError(e)})},triggerEvent:function(e,t,r,n){return s.createClient(e,t).request("\n    mutation triggerEvent($campaignId: String!, $type: EventSubscriptionType!) {\n      send_test_event(campaign_cursor: $campaignId, type: $type){\n        event_type\n        payload\n        hmac\n      }\n    }\n  ",{campaignId:r,type:a(n)}).then(function(e){return e.send_test_event}).catch(function(e){throw s.transformError(e)})}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i=r(12),a=r(16),s=r(2),u=r(4),c=r(5),f=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._={apiAccessTokenCache:r,config:t||null,usersCache:n}}return n(e,[{key:"_assertValidState",value:function(){if(!this._.config)throw TypeError("Illegal State: Default config has not been set yet.")}},{key:"getConversation",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var n,o,s,u,c,f,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.apiKey,o=t.apiSecret,s=t.apiUrlRoot,u=r.after,c=r.limit,f=r.targetCursor,e.next=4,i._.apiAccessTokenCache.get(s,n,o);case 4:return p=e.sent,e.next=7,a.getConversation(s,p,f,u,c);case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n=u.resolveApiCfg(s,this._.config),e.abrupt("return",u.startPaging(r,n,{targetCursor:t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getConversations",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=function(){var e=o(regeneratorRuntime.mark(function e(t,r){var o,i,s,u,c,f,p,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.apiKey,i=t.apiSecret,s=t.apiUrlRoot,u=r.after,c=r.limit,e.next=4,n._.apiAccessTokenCache.get(s,o,i);case 4:return f=e.sent,e.next=7,n._.usersCache.get(s,o,i);case 7:return p=e.sent,l=p.cursor,e.next=11,a.getConversations(s,f,l,u,c);case 11:return h=e.sent,e.abrupt("return",h);case 13:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}(),r=u.resolveApiCfg(i,this._.config),e.abrupt("return",u.startPaging(t,r,{}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,r,n,o,i,a,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),t=u.resolveApiCfg(f,this._.config),r=t.apiKey,n=t.apiSecret,o=t.apiUrlRoot,e.prev=3,e.next=6,this._.usersCache.get(o,r,n);case 6:return i=e.sent,a=new c({data:i}),e.abrupt("return",a);case 11:throw e.prev=11,e.t0=e.catch(3),new s(400,e.t0);case 14:case"end":return e.stop()}},e,this,[[3,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"getUserPublicKey",value:function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,a,f,p,l,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),r=u.resolveApiCfg(h,this._.config),n=r.apiKey,o=r.apiSecret,a=r.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(a,n,o);case 6:return f=e.sent,e.next=9,i.getUserPublicKey(a,f,t);case 9:return p=e.sent,l=new c(p),e.abrupt("return",l);case 14:throw e.prev=14,e.t0=e.catch(3),new s(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"sendUserMessage",value:function(){var e=o(regeneratorRuntime.mark(function e(t,r){var n,o,i,f,p,l,h,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertValidState(),n=u.resolveApiCfg(d,this._.config),o=n.apiKey,i=n.apiSecret,f=n.apiUrlRoot,e.prev=3,e.next=6,this._.apiAccessTokenCache.get(f,o,i);case 6:return p=e.sent,e.next=9,a.sendUserMessage(f,p,t,r);case 9:return l=e.sent,h=new c({data:l}),e.abrupt("return",h);case 14:throw e.prev=14,e.t0=e.catch(3),new s(400,e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"config",set:function(e){this._.config=e}}]),e}();e.exports=f}]);